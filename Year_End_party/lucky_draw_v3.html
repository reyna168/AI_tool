<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°¾ç‰™å‹•æ…‹æŠ½çç³»çµ± (è·‘é¦¬ç‡ˆç‰¹æ•ˆç‰ˆ)</title>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        body {
            font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
            background-color: #1e1e2e;
            color: #fff;
            text-align: center;
            margin: 0;
            padding-bottom: 50px; /* åº•éƒ¨ç•™ç™½ */
        }

        h1 { color: #f1c40f; padding: 20px 0; margin: 0; background: #151520; }

        /* --- æŒ‰éˆ•æ§åˆ¶å€ --- */
        .controls {
            position: sticky;
            top: 0;
            background: #2c3e50;
            padding: 15px;
            z-index: 100;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        button {
            padding: 10px 25px;
            font-size: 1.1em;
            cursor: pointer;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            color: white;
            transition: all 0.2s;
        }
        button:hover { filter: brightness(1.1); transform: translateY(-2px); }
        button:disabled { background-color: #555 !important; cursor: not-allowed; transform: none; opacity: 0.5; }
        
        .btn-3 { background: linear-gradient(45deg, #e67e22, #d35400); }
        .btn-2 { background: linear-gradient(45deg, #3498db, #2980b9); }
        .btn-1 { background: linear-gradient(45deg, #e74c3c, #c0392b); transform: scale(1.1); }
        .btn-reset { background: #7f8c8d; border-radius: 5px; font-size: 0.9em; }

        /* --- å¾—çå±•ç¤ºå€ (ç´¯ç©é¡¯ç¤º) --- */
        #winners-container {
            min-height: 100px;
            padding: 20px;
            display: flex;
            flex-direction: column-reverse; /* æ–°çš„çé …åœ¨æœ€ä¸Šé¢ */
            align-items: center;
            gap: 20px;
        }

        .prize-group {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            width: 90%;
            max-width: 1000px;
            animation: slideDown 0.5s ease;
        }

        .prize-title {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            border-bottom: 1px solid #555;
            padding-bottom: 5px;
        }

        .cards-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
        }

        /* --- å¤§å¼µå¡ç‰‡ (é¡¯ç¤ºçµæœç”¨) --- */
        .big-card {
            width: 100px;
            height: 140px;
            background: white;
            color: #333;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 1.8em;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }
        
        .big-card.red { color: #e74c3c; }
        .big-card.black { color: #2c3e50; }
        
        /* ç‰Œä¸Šçš„æ¨™ç±¤ (ç¬¬å¹¾å‰¯) */
        .deck-badge {
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 0.4em;
            background: #333;
            color: white;
            padding: 2px 5px;
            border-radius: 4px;
        }

        /* è·³å‹•ç‰¹æ•ˆä¸­çš„æ¨¡ç³Šæ„Ÿ */
        .animating {
            background: #f0f0f0;
            color: transparent; /* æ–‡å­—é€æ˜ï¼Œæ”¹ç”¨ text-shadow è£½é€ æ¨¡ç³Š */
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        /* --- åº•éƒ¨ç¸½ç‰Œåº« --- */
        .deck-overview {
            margin-top: 40px;
            padding: 20px;
            background: #151520;
        }
        
        .deck-header { color: #aaa; margin-bottom: 10px; }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 5px;
            max-width: 1100px;
            margin: 0 auto;
        }

        .mini-card {
            height: 55px;
            background: #eee;
            border-radius: 4px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.9em;
            font-weight: bold;
            color: #333;
            position: relative;
            transition: opacity 0.5s;
        }
        
        .mini-card.red { color: #c0392b; }
        .mini-card.black { color: #2c3e50; }
        
        /* ç¬¬ä¸€å‰¯èˆ‡ç¬¬äºŒå‰¯çš„å€éš” (åº•éƒ¨ç·šæ¢) */
        .deck-1-border { border-bottom: 3px solid #3498db; }
        .deck-2-border { border-bottom: 3px solid #e74c3c; }

        /* å¡ç‰‡è¢«æŠ½èµ°å¾Œçš„æ¨£å¼ */
        .mini-card.taken {
            opacity: 0.1;
            filter: grayscale(100%);
            /* é€™è£¡æˆ‘å€‘ä¸ä½¿ç”¨ visibility:hiddenï¼Œé€™æ¨£æ ¼å­æœƒç•™è‘—ä½†è®Šå¾ˆæ·¡ */
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <h1>ğŸ‰ å°¾ç‰™å¹¸é‹æŠ½ç (å‹•æ…‹ç‰ˆ)</h1>

    <div class="controls">
        <button onclick="startDraw(3, 10)" class="btn-3" id="btn-3">ğŸ æŠ½ä¸‰ç (10å)</button>
        <button onclick="startDraw(2, 3)" class="btn-2" id="btn-2">ğŸ¥ˆ æŠ½äºŒç (3å)</button>
        <button onclick="startDraw(1, 1)" class="btn-1" id="btn-1">ğŸ† æŠ½é ­ç (1å)</button>
        <div style="width: 20px;"></div> <button onclick="resetGame()" class="btn-reset">ğŸ”„ å…¨éƒ¨é‡ç½®</button>
    </div>

    <div id="winners-container"></div>

    <div class="deck-overview">
        <div class="deck-header">ğŸ”» ç¸½ç‰Œåº«ç›£æ§ (å…± 104 å¼µï¼ŒæŠ½ä¸­å³è®Šæš—) ğŸ”»</div>
        
        <h4 style="color:#3498db">ç¬¬ä¸€å‰¯ç‰Œ</h4>
        <div class="grid-container" id="deck-grid-1"></div>
        
        <h4 style="color:#e74c3c; margin-top:20px;">ç¬¬äºŒå‰¯ç‰Œ</h4>
        <div class="grid-container" id="deck-grid-2"></div>
    </div>

    <script>
        // --- éŠæˆ²è³‡æ–™è¨­å®š ---
        const suits = [
            { symbol: 'â™ ', color: 'black' },
            { symbol: 'â™¥', color: 'red' },
            { symbol: 'â™¦', color: 'red' },
            { symbol: 'â™£', color: 'black' }
        ];
        const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
        
        let deck = [];
        let isAnimating = false; // é˜²æ­¢é‡è¤‡é»æ“Š

        // åˆå§‹åŒ–
        function initGame() {
            deck = [];
            document.getElementById('winners-container').innerHTML = '';
            document.getElementById('deck-grid-1').innerHTML = '';
            document.getElementById('deck-grid-2').innerHTML = '';
            
            // é‡å•ŸæŒ‰éˆ•
            ['btn-1', 'btn-2', 'btn-3'].forEach(id => {
                document.getElementById(id).disabled = false;
            });

            let idCounter = 0;

            // å»ºç«‹å…©å‰¯ç‰Œ
            for (let d = 1; d <= 2; d++) {
                const container = document.getElementById(`deck-grid-${d}`);
                
                suits.forEach(suit => {
                    ranks.forEach(rank => {
                        const card = {
                            id: idCounter++,
                            deck: d,
                            suit: suit.symbol,
                            rank: rank,
                            color: suit.color,
                            drawn: false
                        };
                        deck.push(card);

                        // å»ºç«‹åº•éƒ¨çš„å°ç‰Œå…ƒç´ 
                        const div = document.createElement('div');
                        div.className = `mini-card ${card.color} deck-${d}-border`;
                        div.id = `mini-${card.id}`;
                        div.innerText = `${suit.symbol}${rank}`;
                        container.appendChild(div);
                    });
                });
            }
        }

        // --- æ ¸å¿ƒæŠ½çæµç¨‹ ---
        function startDraw(prizeLevel, count) {
            if (isAnimating) return; // å‹•ç•«ä¸­ç¦æ­¢æ“ä½œ

            // 1. ç¯©é¸å‰©é¤˜çš„ç‰Œ
            const availableDeck = deck.filter(c => !c.drawn);
            
            if (availableDeck.length < count) {
                alert("ç‰Œåº«æ•¸é‡ä¸è¶³ï¼");
                return;
            }

            isAnimating = true;
            disableButtons(true);

            // 2. é å…ˆé¸å‡ºä¸­çè€… (å¾Œç«¯é‚è¼¯)
            const winners = [];
            for(let i=0; i<count; i++) {
                const idx = Math.floor(Math.random() * availableDeck.length);
                const winner = availableDeck[idx];
                winners.push(winner);
                
                // åœ¨é‚è¼¯ä¸Šå…ˆç§»é™¤ï¼Œé¿å…é€™æ¬¡æŠ½çå…§éƒ¨é‡è¤‡ (é›–ç„¶æ©Ÿç‡ä½)
                availableDeck.splice(idx, 1);
                
                // æ¨™è¨˜åŸå§‹ deck ä¸­çš„ç‹€æ…‹
                const originalCard = deck.find(c => c.id === winner.id);
                originalCard.drawn = true;
            }

            // 3. å»ºç«‹ä»‹é¢ä¸¦é–‹å§‹å‹•ç•«
            createResultGroup(prizeLevel, winners);
        }

        // å»ºç«‹è©²æ¬¡æŠ½ççš„é¡¯ç¤ºå€å¡Š
        function createResultGroup(level, winners) {
            const titles = { 1: "ğŸ† é ­ç (Head Prize)", 2: "ğŸ¥ˆ äºŒç (2nd Prize)", 3: "ğŸ ä¸‰ç (3rd Prize)" };
            const container = document.getElementById('winners-container');

            // å»ºç«‹å¤–æ¡†
            const groupDiv = document.createElement('div');
            groupDiv.className = 'prize-group';
            
            const titleDiv = document.createElement('div');
            titleDiv.className = 'prize-title';
            titleDiv.innerText = titles[level];
            groupDiv.appendChild(titleDiv);

            const cardsRow = document.createElement('div');
            cardsRow.className = 'cards-row';

            // ç‚ºæ¯å€‹ä¸­çè€…å»ºç«‹ä¸€å€‹ã€Œé¡¯ç¤ºæ¡†ã€ï¼Œåˆå§‹å…§å®¹æ˜¯éš¨æ©Ÿäº‚è·³çš„
            const slotElements = [];
            winners.forEach(winner => {
                const cardEl = document.createElement('div');
                cardEl.className = 'big-card animating'; // åŠ ä¸Š animating class
                cardEl.innerHTML = `<div class="deck-badge">?</div><span>ğŸ²</span>`; 
                cardsRow.appendChild(cardEl);
                
                // å„²å­˜å…ƒç´ èˆ‡å°æ‡‰çš„æœ€çµ‚çµæœ
                slotElements.push({
                    element: cardEl,
                    finalCard: winner
                });
            });

            groupDiv.appendChild(cardsRow);
            container.appendChild(groupDiv); // æ’å…¥åˆ°ç•«é¢ä¸Š

            // 4. åŸ·è¡Œè·‘é¦¬ç‡ˆå‹•ç•«
            runSlotAnimation(slotElements, level);
        }

        // åŸ·è¡Œè·‘é¦¬ç‡ˆé‚è¼¯
        function runSlotAnimation(slots, level) {
            // è®“æ¯å€‹å¡ç‰‡æ¡†æ¡†è£¡çš„å…§å®¹å¿«é€Ÿè®Šæ›
            const intervalId = setInterval(() => {
                slots.forEach(slotObj => {
                    // éš¨æ©Ÿé¡¯ç¤ºä¸€å€‹å‡å…§å®¹
                    const randomSuit = suits[Math.floor(Math.random()*4)];
                    const randomRank = ranks[Math.floor(Math.random()*13)];
                    slotObj.element.innerHTML = `
                        <div class="deck-badge">Rolling...</div>
                        <span style="color:${randomSuit.color}">${randomSuit.symbol}${randomRank}</span>
                    `;
                });
            }, 60); // æ¯ 60ms æ›ä¸€æ¬¡ï¼Œé€Ÿåº¦å¿«

            // è¨­å®šåœæ­¢æ™‚é–“ï¼šæ¨¡æ“¬ç·Šå¼µæ„Ÿï¼Œ3ç§’å¾Œåœæ­¢
            setTimeout(() => {
                clearInterval(intervalId);
                revealWinners(slots);
                
                // å‹•ç•«çµæŸï¼Œè§£é–æŒ‰éˆ• (ä½†ä¸è§£é–å·²æŠ½éçš„çé …)
                isAnimating = false;
                disableButtons(false);
                document.getElementById(`btn-${level}`).disabled = true; // é–å®šå‰›æŠ½å®Œçš„æŒ‰éˆ•
                
            }, 2500); 
        }

        // æ­æ›‰çµæœä¸¦æ›´æ–°åº•éƒ¨ç‰Œåº«
        function revealWinners(slots) {
            slots.forEach((slotObj, index) => {
                const card = slotObj.finalCard;
                const el = slotObj.element;
                
                // ç§»é™¤å‹•ç•«æ¨£å¼ï¼Œé¡¯ç¤ºçœŸå€¼
                el.classList.remove('animating');
                el.classList.add(card.color); // åŠ ä¸Šç´…/é»‘è‰²
                el.innerHTML = `
                    <div class="deck-badge">ç¬¬ ${card.deck} å‰¯</div>
                    <div>${card.suit}</div>
                    <div>${card.rank}</div>
                `;

                // **é—œéµï¼šåŒæ™‚è®“åº•éƒ¨ç‰Œåº«çš„é‚£å¼µç‰Œè®Šæš—**
                const miniCard = document.getElementById(`mini-${card.id}`);
                if (miniCard) {
                    miniCard.classList.add('taken');
                }
            });
        }

        function disableButtons(disabled) {
            const btns = document.querySelectorAll('.controls button:not(.btn-reset)');
            btns.forEach(b => {
                // å¦‚æœæŒ‰éˆ•æœ¬ä¾†å°±æ˜¯ disabled (å·²ç¶“æŠ½éçš„)ï¼Œä¸è¦æŠŠå®ƒè®Šå› enabled
                if (!disabled && b.getAttribute('data-done') === 'true') return;
                b.disabled = disabled;
            });
        }

        function resetGame() {
            if(confirm("ç¢ºå®šè¦å…¨éƒ¨é‡ç½®ï¼Ÿæ­·å²ç´€éŒ„å°‡æœƒæ¸…ç©ºã€‚")) {
                initGame();
            }
        }

        // å•Ÿå‹•
        initGame();

    </script>
</body>
</html>