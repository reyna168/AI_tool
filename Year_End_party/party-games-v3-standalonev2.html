<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°¾ç‰™æ´¾å°éŠæˆ² V3</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Lucide React Icons (æ‰‹å‹•å¯¦ä½œç°¡åŒ–ç‰ˆ)
        const Sparkles = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M12 2l3 7 7 3-7 3-3 7-3-7-7-3 7-3 3-7z"/>
            </svg>
        );

        const Dices = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <circle cx="8" cy="8" r="1" fill="currentColor"/>
                <circle cx="16" cy="16" r="1" fill="currentColor"/>
                <circle cx="12" cy="12" r="1" fill="currentColor"/>
            </svg>
        );

        const Trophy = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M6 9H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2h-2"/>
                <path d="M6 9v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V9"/>
                <path d="M9 22v-2h6v2"/>
            </svg>
        );

        const PartyGames = () => {
            const [currentGame, setCurrentGame] = useState('menu');
            
            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-600 via-pink-500 to-red-500 p-4">
                    <div className="max-w-4xl mx-auto">
                        {currentGame === 'menu' && <GameMenu setCurrentGame={setCurrentGame} />}
                        {currentGame === 'lucky-draw' && <LuckyDraw setCurrentGame={setCurrentGame} />}
                        {currentGame === 'number-bomb' && <NumberBomb setCurrentGame={setCurrentGame} />}
                        {currentGame === 'spin-wheel' && <SpinWheel setCurrentGame={setCurrentGame} />}
                    </div>
                </div>
            );
        };

        const GameMenu = ({ setCurrentGame }) => {
            const games = [
                { id: 'lucky-draw', name: 'æŠ½çè½‰ç›¤', icon: Sparkles, desc: 'éš¨æ©ŸæŠ½å‡ºå¹¸é‹å…’' },
                { id: 'number-bomb', name: 'æ•¸å­—ç‚¸å½ˆ', icon: Dices, desc: 'åˆºæ¿€çš„æ•¸å­—éŠæˆ²' },
                { id: 'spin-wheel', name: 'å‘½é‹è½‰ç›¤', icon: Trophy, desc: 'è½‰å‡ºä½ çš„çå“' }
            ];

            return (
                <div className="text-center">
                    <h1 className="text-5xl font-bold text-white mb-4 drop-shadow-lg">ğŸ‰ å°¾ç‰™éŠæˆ²</h1>
                    <p className="text-xl text-white mb-12 drop-shadow">é¸æ“‡ä¸€å€‹éŠæˆ²é–‹å§‹</p>
                    
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        {games.map(game => (
                            <button
                                key={game.id}
                                onClick={() => setCurrentGame(game.id)}
                                className="bg-white rounded-2xl p-8 shadow-2xl hover:scale-105 transform transition-all duration-300 hover:shadow-purple-500/50"
                            >
                                <game.icon className="w-16 h-16 mx-auto mb-4 text-purple-600" />
                                <h3 className="text-2xl font-bold text-gray-800 mb-2">{game.name}</h3>
                                <p className="text-gray-600">{game.desc}</p>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const LuckyDraw = ({ setCurrentGame }) => {
            const [names, setNames] = useState('');
            const [participants, setParticipants] = useState([]);
            const [remainingParticipants, setRemainingParticipants] = useState([]);
            const [isSpinning, setIsSpinning] = useState(false);
            const [winner, setWinner] = useState('');
            const [currentName, setCurrentName] = useState('');
            const [winnerHistory, setWinnerHistory] = useState([]);

            const startDraw = () => {
                const nameList = names.split('\n').filter(n => n.trim());
                if (nameList.length === 0) return;
                
                setParticipants(nameList);
                setRemainingParticipants(nameList);
                setWinnerHistory([]);
                setWinner('');
            };

            const drawWinner = () => {
                if (remainingParticipants.length === 0) {
                    alert('å·²ç¶“æ²’æœ‰åƒåŠ è€…äº†ï¼');
                    return;
                }

                setIsSpinning(true);
                setWinner('');
                
                let count = 0;
                const interval = setInterval(() => {
                    setCurrentName(remainingParticipants[Math.floor(Math.random() * remainingParticipants.length)]);
                    count++;
                    
                    if (count > 30) {
                        clearInterval(interval);
                        const finalWinner = remainingParticipants[Math.floor(Math.random() * remainingParticipants.length)];
                        setWinner(finalWinner);
                        setIsSpinning(false);
                        
                        setRemainingParticipants(prev => prev.filter(name => name !== finalWinner));
                        setWinnerHistory(prev => [...prev, finalWinner]);
                    }
                }, 100);
            };

            const addBackWinner = (name) => {
                setRemainingParticipants(prev => [...prev, name]);
                setWinnerHistory(prev => prev.filter(n => n !== name));
            };

            const removeParticipant = (name) => {
                setRemainingParticipants(prev => prev.filter(n => n !== name));
            };

            return (
                <div className="bg-white rounded-3xl p-8 shadow-2xl">
                    <button onClick={() => setCurrentGame('menu')} className="mb-4 text-purple-600 hover:text-purple-800 text-lg font-bold">
                        â† è¿”å›é¸å–®
                    </button>
                    
                    <h2 className="text-4xl font-bold text-center mb-8 text-purple-600">ğŸ¯ æŠ½çè½‰ç›¤</h2>
                    
                    {remainingParticipants.length === 0 && participants.length === 0 ? (
                        <div>
                            <textarea
                                value={names}
                                onChange={(e) => setNames(e.target.value)}
                                placeholder="è¼¸å…¥åƒåŠ è€…åå­—ï¼ˆæ¯è¡Œä¸€å€‹ï¼‰&#10;ä¾‹å¦‚ï¼š&#10;å¼µä¸‰&#10;æå››&#10;ç‹äº”&#10;è¶™å…­"
                                className="w-full h-48 p-4 border-2 border-purple-300 rounded-xl mb-4 text-lg"
                            />
                            <button
                                onClick={startDraw}
                                className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white text-2xl font-bold py-4 rounded-xl hover:scale-105 transform transition-all"
                            >
                                é–‹å§‹æŠ½ç ğŸ²
                            </button>
                        </div>
                    ) : (
                        <div>
                            <div className="grid grid-cols-2 gap-4 mb-6">
                                <div className="bg-blue-100 rounded-xl p-4 text-center">
                                    <div className="text-gray-600 text-lg">å‰©é¤˜äººæ•¸</div>
                                    <div className="text-4xl font-bold text-blue-600">{remainingParticipants.length}</div>
                                </div>
                                <div className="bg-green-100 rounded-xl p-4 text-center">
                                    <div className="text-gray-600 text-lg">å·²ä¸­ç</div>
                                    <div className="text-4xl font-bold text-green-600">{winnerHistory.length}</div>
                                </div>
                            </div>

                            <div className="bg-gradient-to-br from-yellow-400 to-orange-500 rounded-3xl p-16 mb-6 min-h-64 flex items-center justify-center">
                                {isSpinning ? (
                                    <div className="text-6xl font-bold text-white animate-pulse">{currentName}</div>
                                ) : winner ? (
                                    <div>
                                        <div className="text-7xl font-bold text-white mb-4 animate-bounce">ğŸŠ {winner} ğŸŠ</div>
                                        <div className="text-3xl text-white">æ­å–œä¸­çï¼</div>
                                        <div className="text-xl text-white mt-2">(å·²è‡ªå‹•ç§»é™¤)</div>
                                    </div>
                                ) : (
                                    <div className="text-4xl text-white">æº–å‚™æŠ½ç...</div>
                                )}
                            </div>
                            
                            {!isSpinning && (
                                <div className="space-y-3 mb-6">
                                    <button
                                        onClick={drawWinner}
                                        disabled={remainingParticipants.length === 0}
                                        className={`w-full text-2xl font-bold py-4 rounded-xl transition-all ${
                                            remainingParticipants.length === 0
                                                ? 'bg-gray-400 cursor-not-allowed'
                                                : 'bg-gradient-to-r from-purple-600 to-pink-600 hover:scale-105 transform'
                                        } text-white`}
                                    >
                                        {remainingParticipants.length === 0 ? 'å·²æŠ½å®Œï¼' : 'ç¹¼çºŒæŠ½ç ğŸ²'}
                                    </button>
                                    <button
                                        onClick={() => {
                                            setParticipants([]);
                                            setRemainingParticipants([]);
                                            setNames('');
                                            setWinner('');
                                            setWinnerHistory([]);
                                        }}
                                        className="w-full bg-gray-500 text-white text-xl font-bold py-3 rounded-xl hover:bg-gray-600"
                                    >
                                        é‡æ–°è¨­å®š
                                    </button>
                                </div>
                            )}

                            {winnerHistory.length > 0 && (
                                <div className="bg-green-50 rounded-xl p-4 mb-4">
                                    <h3 className="text-xl font-bold text-green-700 mb-3">ğŸ† ä¸­çåå–®</h3>
                                    <div className="space-y-2">
                                        {winnerHistory.map((name, index) => (
                                            <div key={index} className="flex items-center justify-between bg-white p-3 rounded-lg">
                                                <span className="text-lg">
                                                    <span className="font-bold text-green-600">#{index + 1}</span> {name}
                                                </span>
                                                <button
                                                    onClick={() => addBackWinner(name)}
                                                    className="bg-blue-500 text-white px-4 py-1 rounded-lg hover:bg-blue-600 text-sm"
                                                >
                                                    æ”¾å›æŠ½ç
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {remainingParticipants.length > 0 && (
                                <div className="bg-blue-50 rounded-xl p-4">
                                    <h3 className="text-xl font-bold text-blue-700 mb-3">ğŸ‘¥ å‰©é¤˜åƒåŠ è€… ({remainingParticipants.length}äºº)</h3>
                                    <div className="flex flex-wrap gap-2">
                                        {remainingParticipants.map((name, index) => (
                                            <div key={index} className="bg-white px-4 py-2 rounded-lg shadow-sm flex items-center gap-2">
                                                <span>{name}</span>
                                                <button
                                                    onClick={() => removeParticipant(name)}
                                                    className="text-red-500 hover:text-red-700 font-bold"
                                                >
                                                    Ã—
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        const NumberBomb = ({ setCurrentGame }) => {
            const [minNum, setMinNum] = useState(1);
            const [maxNum, setMaxNum] = useState(99);
            const [bombNum, setBombNum] = useState(0);
            const [gameStarted, setGameStarted] = useState(false);
            const [inputNum, setInputNum] = useState('');
            const [message, setMessage] = useState('');
            const [history, setHistory] = useState([]);

            const startGame = () => {
                const bomb = Math.floor(Math.random() * 99) + 1;
                setBombNum(bomb);
                setMinNum(1);
                setMaxNum(99);
                setGameStarted(true);
                setMessage('');
                setHistory([]);
                setInputNum('');
            };

            const guess = () => {
                const num = parseInt(inputNum);
                
                if (isNaN(num) || num < minNum || num > maxNum) {
                    setMessage(`è«‹è¼¸å…¥ ${minNum} åˆ° ${maxNum} ä¹‹é–“çš„æ•¸å­—`);
                    return;
                }

                if (num === bombNum) {
                    setMessage('ğŸ’£ çˆ†ç‚¸äº†ï¼ä½ è¸©åˆ°ç‚¸å½ˆäº†ï¼');
                    setHistory([...history, { num, result: 'bomb' }]);
                    setGameStarted(false);
                } else {
                    if (num < bombNum) {
                        setMinNum(num + 1);
                        setMessage(`å®‰å…¨ï¼ç¯„åœç¸®å°ç‚º ${num + 1} ~ ${maxNum}`);
                        setHistory([...history, { num, result: 'safe' }]);
                    } else {
                        setMaxNum(num - 1);
                        setMessage(`å®‰å…¨ï¼ç¯„åœç¸®å°ç‚º ${minNum} ~ ${num - 1}`);
                        setHistory([...history, { num, result: 'safe' }]);
                    }
                }
                
                setInputNum('');
            };

            return (
                <div className="bg-white rounded-3xl p-8 shadow-2xl">
                    <button onClick={() => setCurrentGame('menu')} className="mb-4 text-purple-600 hover:text-purple-800 text-lg font-bold">
                        â† è¿”å›é¸å–®
                    </button>
                    
                    <h2 className="text-4xl font-bold text-center mb-8 text-purple-600">ğŸ’£ æ•¸å­—ç‚¸å½ˆ</h2>
                    
                    {!gameStarted ? (
                        <div className="text-center">
                            <div className="text-xl mb-8 text-gray-600">
                                éŠæˆ²æœƒéš¨æ©Ÿé¸ä¸€å€‹ 1-99 çš„æ•¸å­—ç•¶ç‚¸å½ˆ<br/>
                                è¼ªæµçŒœæ•¸å­—ï¼Œç¯„åœæœƒè¶Šä¾†è¶Šå°<br/>
                                çŒœåˆ°ç‚¸å½ˆçš„äººå°±è¼¸äº†ï¼
                            </div>
                            {message && (
                                <div className="text-4xl font-bold mb-8 text-red-600 animate-bounce">
                                    {message}
                                </div>
                            )}
                            <button
                                onClick={startGame}
                                className="bg-gradient-to-r from-purple-600 to-pink-600 text-white text-2xl font-bold py-4 px-12 rounded-xl hover:scale-105 transform transition-all"
                            >
                                é–‹å§‹éŠæˆ²
                            </button>
                        </div>
                    ) : (
                        <div>
                            <div className="bg-gradient-to-br from-red-500 to-orange-500 rounded-2xl p-8 mb-6 text-center">
                                <div className="text-white text-3xl font-bold mb-2">ç•¶å‰ç¯„åœ</div>
                                <div className="text-white text-6xl font-bold">{minNum} ~ {maxNum}</div>
                            </div>
                            
                            <div className="flex gap-4 mb-6">
                                <input
                                    type="number"
                                    value={inputNum}
                                    onChange={(e) => setInputNum(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && guess()}
                                    placeholder="è¼¸å…¥æ•¸å­—"
                                    className="flex-1 text-3xl p-4 border-2 border-purple-300 rounded-xl text-center"
                                />
                                <button
                                    onClick={guess}
                                    className="bg-purple-600 text-white text-2xl font-bold px-8 rounded-xl hover:bg-purple-700"
                                >
                                    çŒœï¼
                                </button>
                            </div>
                            
                            {message && (
                                <div className={`text-2xl font-bold text-center p-4 rounded-xl mb-6 ${
                                    message.includes('çˆ†ç‚¸') ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'
                                }`}>
                                    {message}
                                </div>
                            )}
                            
                            {history.length > 0 && (
                                <div className="bg-gray-100 rounded-xl p-4">
                                    <div className="text-lg font-bold mb-2 text-gray-700">çŒœæ¸¬è¨˜éŒ„</div>
                                    <div className="flex flex-wrap gap-2">
                                        {history.map((h, i) => (
                                            <span key={i} className={`px-4 py-2 rounded-lg font-bold ${
                                                h.result === 'bomb' ? 'bg-red-500 text-white' : 'bg-green-500 text-white'
                                            }`}>
                                                {h.num}
                                            </span>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        const SpinWheel = ({ setCurrentGame }) => {
            const [prizes, setPrizes] = useState('');
            const [prizeList, setPrizeList] = useState([]);
            const [isSpinning, setIsSpinning] = useState(false);
            const [rotation, setRotation] = useState(0);
            const [result, setResult] = useState('');

            const setupWheel = () => {
                const list = prizes.split('\n').filter(p => p.trim());
                if (list.length < 2) return;
                setPrizeList(list);
            };

            const spin = () => {
                setIsSpinning(true);
                setResult('');
                
                const spins = 5 + Math.random() * 5;
                const extraDegrees = Math.random() * 360;
                const totalRotation = rotation + (spins * 360) + extraDegrees;
                
                setRotation(totalRotation);
                
                setTimeout(() => {
                    const finalAngle = totalRotation % 360;
                    const segmentAngle = 360 / prizeList.length;
                    const selectedIndex = Math.floor((360 - finalAngle) / segmentAngle) % prizeList.length;
                    setResult(prizeList[selectedIndex]);
                    setIsSpinning(false);
                }, 4000);
            };

            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2'];

            return (
                <div className="bg-white rounded-3xl p-8 shadow-2xl">
                    <button onClick={() => setCurrentGame('menu')} className="mb-4 text-purple-600 hover:text-purple-800 text-lg font-bold">
                        â† è¿”å›é¸å–®
                    </button>
                    
                    <h2 className="text-4xl font-bold text-center mb-8 text-purple-600">ğŸ¡ å‘½é‹è½‰ç›¤</h2>
                    
                    {prizeList.length === 0 ? (
                        <div>
                            <textarea
                                value={prizes}
                                onChange={(e) => setPrizes(e.target.value)}
                                placeholder="è¼¸å…¥çå“é …ç›®ï¼ˆæ¯è¡Œä¸€å€‹ï¼‰&#10;ä¾‹å¦‚ï¼š&#10;iPhone 15&#10;Switch&#10;AirPods&#10;æ˜Ÿå·´å…‹ç¦®åˆ¸"
                                className="w-full h-48 p-4 border-2 border-purple-300 rounded-xl mb-4 text-lg"
                            />
                            <button
                                onClick={setupWheel}
                                className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white text-2xl font-bold py-4 rounded-xl hover:scale-105 transform transition-all"
                            >
                                å»ºç«‹è½‰ç›¤
                            </button>
                        </div>
                    ) : (
                        <div className="text-center">
                            <div className="relative w-80 h-80 mx-auto mb-8">
                                <div className="absolute inset-0 rounded-full border-8 border-yellow-400 shadow-2xl"></div>
                                
                                <svg
                                    viewBox="0 0 200 200"
                                    className="w-full h-full"
                                    style={{
                                        transform: `rotate(${rotation}deg)`,
                                        transition: isSpinning ? 'transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99)' : 'none'
                                    }}
                                >
                                    {prizeList.map((prize, i) => {
                                        const angle = (360 / prizeList.length) * i;
                                        const nextAngle = (360 / prizeList.length) * (i + 1);
                                        const startRad = (angle - 90) * (Math.PI / 180);
                                        const endRad = (nextAngle - 90) * (Math.PI / 180);
                                        
                                        const x1 = 100 + 90 * Math.cos(startRad);
                                        const y1 = 100 + 90 * Math.sin(startRad);
                                        const x2 = 100 + 90 * Math.cos(endRad);
                                        const y2 = 100 + 90 * Math.sin(endRad);
                                        
                                        return (
                                            <g key={i}>
                                                <path
                                                    d={`M 100 100 L ${x1} ${y1} A 90 90 0 ${prizeList.length <= 2 ? 1 : 0} 1 ${x2} ${y2} Z`}
                                                    fill={colors[i % colors.length]}
                                                    stroke="white"
                                                    strokeWidth="2"
                                                />
                                                <text
                                                    x="100"
                                                    y="55"
                                                    fill="white"
                                                    fontSize="10"
                                                    fontWeight="bold"
                                                    textAnchor="middle"
                                                    transform={`rotate(${angle + 360 / prizeList.length / 2} 100 100)`}
                                                >
                                                    {prize.length > 8 ? prize.substring(0, 8) + '...' : prize}
                                                </text>
                                            </g>
                                        );
                                    })}
                                    <circle cx="100" cy="100" r="15" fill="gold" stroke="#333" strokeWidth="2"/>
                                    <circle cx="100" cy="100" r="8" fill="white"/>
                                </svg>
                                
                                <div className="absolute left-1/2 z-10" style={{top: '-8px', transform: 'translateX(-50%)'}}>
                                    <div className="relative">
                                        <div style={{
                                            width: 0,
                                            height: 0,
                                            borderLeft: '20px solid transparent',
                                            borderRight: '20px solid transparent',
                                            borderTop: '40px solid #dc2626',
                                            filter: 'drop-shadow(0 4px 6px rgba(0,0,0,0.3))'
                                        }}></div>
                                        <div style={{
                                            position: 'absolute',
                                            top: '-8px',
                                            left: '50%',
                                            transform: 'translateX(-50%)',
                                            width: '24px',
                                            height: '24px',
                                            backgroundColor: '#dc2626',
                                            borderRadius: '50%',
                                            border: '4px solid white',
                                            boxShadow: '0 4px 6px rgba(0,0,0,0.3)'
                                        }}></div>
                                    </div>
                                </div>
                            </div>
                            
                            {result && (
                                <div className="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-2xl p-8 mb-6 animate-bounce">
                                    <div className="text-4xl font-bold text-white mb-2">ğŸ‰ æ­å–œç²å¾— ğŸ‰</div>
                                    <div className="text-5xl font-bold text-white">{result}</div>
                                </div>
                            )}
                            
                            <button
                                onClick={spin}
                                disabled={isSpinning}
                                className={`w-full text-2xl font-bold py-4 rounded-xl transition-all ${
                                    isSpinning 
                                        ? 'bg-gray-400 cursor-not-allowed' 
                                        : 'bg-gradient-to-r from-purple-600 to-pink-600 hover:scale-105 transform'
                                } text-white`}
                            >
                                {isSpinning ? 'è½‰å‹•ä¸­...' : 'é–‹å§‹è½‰ï¼'}
                            </button>
                            
                            <button
                                onClick={() => {
                                    setPrizeList([]);
                                    setPrizes('');
                                    setResult('');
                                    setRotation(0);
                                }}
                                className="w-full mt-4 bg-gray-500 text-white text-xl font-bold py-3 rounded-xl hover:bg-gray-600"
                            >
                                é‡æ–°è¨­å®š
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PartyGames />);
    </script>
</body>
</html>